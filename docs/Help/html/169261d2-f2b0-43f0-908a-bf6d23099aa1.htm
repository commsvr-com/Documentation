<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Reading from SQL and copying to OPC</title><meta name="Language" content="en-us" /><meta name="System.Keywords" content="SQL Conectivity, Periodic DataBase read" /><meta name="System.Keywords" content="SQL Conectivity, read data from database" /><meta name="System.Keywords" content="SQL Conectivity, read from SQL" /><meta name="Microsoft.Help.Id" content="169261d2-f2b0-43f0-908a-bf6d23099aa1" /><meta name="Description" content="DataPorter allows also to read data from SQL database and write those data to OPC." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-3.3.1.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">CommServer<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/2dea0752-d490-47e6-8444-ac73e07601fc.htm" title="CommServer" tocid="roottoc">CommServer</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/b8c5f048-bb7e-4742-b7f2-b61a77789ed9.htm" title="DataPorter" tocid="b8c5f048-bb7e-4742-b7f2-b61a77789ed9">DataPorter</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/a5b37bb1-ca47-4770-900e-85b8da61cfe6.htm" title="Configuration" tocid="a5b37bb1-ca47-4770-900e-85b8da61cfe6">Configuration</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/26dd91e2-db6e-4a3a-ac32-a7f14422e466.htm" title="SQL Conectivity" tocid="26dd91e2-db6e-4a3a-ac32-a7f14422e466">SQL Conectivity</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/9f3954b0-cc3e-46d1-a3e6-59649db7e738.htm" title="Example simple database configuration" tocid="9f3954b0-cc3e-46d1-a3e6-59649db7e738">Example simple database configuration</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/42ac5182-238c-41a2-81a7-f66a77089b02.htm" title="Storing From Opc Into Sql " tocid="42ac5182-238c-41a2-81a7-f66a77089b02">Storing From Opc Into Sql </a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/169261d2-f2b0-43f0-908a-bf6d23099aa1.htm" title="Reading from SQL and copying to OPC" tocid="169261d2-f2b0-43f0-908a-bf6d23099aa1">Reading from SQL and copying to OPC</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/f0eee719-9f00-47e8-8c6a-2052ba3f7dfa.htm" title="Advanced DataBase operation block" tocid="f0eee719-9f00-47e8-8c6a-2052ba3f7dfa">Advanced DataBase operation block</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Reading from SQL and copying to OPC</h1></td></tr></table><span class="introStyle"><A href="http://www.commsvr.com/tabid/55/language/en-US/Default.aspx" title="CommServer online help" target="_blank">Home</A></span> <div class="introduction"><p>
        DataPorter allows also to read data from SQL database and write those data to OPC.
      </p><div class="mediaCenter"><img alt="FromSQLtoOPC.jpg" src="../media/FromSQLtoOPC.jpg" /></div></div><div id="ID1RBSection" class="collapsibleSection"><p>
          The simplest way to achieve this is to add a new transaction to the configuration, that contains two operation blocks: DB Read (Periodic DataBase read) and Write Item, see example in the figure below:
        </p><div class="mediaCenter"><img alt="Transaction_DB2OPC.jpg" src="../media/Transaction_DB2OPC.jpg" /></div><p>
          The Write Item operation indicates the OPC item in which data from the database shall be stored. The DB Read operation must be configured to connect to the desired database and perform an appropriate select query.
        </p><p>
          The configuration of the “DB read” operation is very similar to “DB save”, so it is recommend that the following articles are read to learn how the database operations work in DataPorter:
        </p><ul><li><p><a href="9f3954b0-cc3e-46d1-a3e6-59649db7e738.htm">Example simple database configuration</a></p></li><li><p><a href="42ac5182-238c-41a2-81a7-f66a77089b02.htm">Storing From Opc Into Sql</a></p></li></ul><p>
          Lets take a look at the default configuration of “DB read”. This operation is preconfigured to use an example DataBase (installed by default with the DataPorter); the table has the structure crated by the following command:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAHABAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAHABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAHABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAHABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">CREATE TABLE OPCDataTable
(
           [timestamp] [datetime] NOT NULL,
           [name] [nchar](255) NOT NULL,
          [opcvalue] [float] NULL,
          [opcquality] [nchar](20) NULL
)</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAHABAAA");</script><p>
          In this example we want to read always the newest value stored in this database table , so we want to execute the following query:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAFABAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAFABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAFABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAFABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">SELECT top 1 [opcvalue] FROM [OPCDataTable] order by [timestamp] desc</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAFABAAA");</script><p>
          Note that currently only one value can be processed and read from one query. To read many elements from the database, many queries must be executed, but all of those queries can be a part of one operation in DataPorter and the operation will have many outputs.
        </p><p>
          It this example, the “DB read” operation may contain an XML configuration similar to the following:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EACABAAA_tab1" class="codeSnippetContainerTabSingle">XML</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-xml-bracket">&lt;?</span><span class="highlight-xml-tag">xml</span> <span class="highlight-xml-attribute-name">version</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"1.0"</span> <span class="highlight-xml-attribute-name">encoding</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"utf-8"</span> <span class="highlight-xml-bracket">?&gt;</span>
<span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">Param</span><span class="highlight-xml-bracket">&gt;</span>
  <span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">operationdb</span> <span class="highlight-xml-attribute-name">name</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"MSSQL"</span> <span class="highlight-xml-attribute-name">connectionstring</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|DataPorterDataBase.mdf;Integrated
  Security=True;Connect Timeout=30;User Instance=True"</span> <span class="highlight-xml-attribute-name">stop</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"false"</span> <span class="highlight-xml-attribute-name">type</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"ExecuteScalar"</span> <span class="highlight-xml-attribute-name">async</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"false"</span><span class="highlight-xml-bracket">&gt;</span>
    <span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">command</span> <span class="highlight-xml-attribute-name">separator</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">""</span><span class="highlight-xml-bracket">&gt;</span>SELECT top 1 [opcvalue] FROM [OPCDataTable] order by [timestamp] desc<span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">command</span><span class="highlight-xml-bracket">&gt;</span>
  <span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">operationdb</span><span class="highlight-xml-bracket">&gt;</span>
  <span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">operationopc</span> <span class="highlight-xml-attribute-name">name</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"opc"</span> <span class="highlight-xml-attribute-name">type</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"write"</span><span class="highlight-xml-bracket">&gt;</span>
    <span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">output</span> <span class="highlight-xml-attribute-name">name</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"0"</span><span class="highlight-xml-bracket">&gt;</span><span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">output</span><span class="highlight-xml-bracket">&gt;</span>
    <span class="highlight-xml-comment">&lt;!--value of accumulator is written to output 0 --&gt;</span>
  <span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">operationopc</span><span class="highlight-xml-bracket">&gt;</span>
<span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">Param</span><span class="highlight-xml-bracket">&gt;</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACABAAA");</script><p>
          This sample script contains:
        </p><ul><li><p>
              Database connection configuration (inside the operationdb element). In this example the default (installed with DataPorter) database file is used (more about database connection configuration can be found in article: [Storing From Opc Into Sql (Advanced Configuration)]. Note that a special type of operationdb is used: type=”ExecuteScalar”, which means that the query is executed in a special mode where only the first line of the response is processed. (DataPorter executes the query, and returns the first column of the first row from the result set returned by the query. Additional columns or rows are ignored.) It is also necessary to use the async="false" option of the operationdb element, which means that DataPorter waits inside this operation till the result of the query is available.
            </p></li><li><p>
              Selection query inside the command element, that contains the query presented above. The result of the query is stored inside an accumulator.
            </p></li><li><p>
              Writing the result of query (stored temporarily inside the accumulator) to the OPC item connected to the first (no. 0) output.
            </p></li></ul></div></div></div><div id="pageFooter" class="pageFooter">This documentation is designed to be used with CAS CommServer (this software is available at <A href="http://www.commsvr.com/index.php/products" title="CommServer -multiprotocol, multichannel, redundant communication server – software installation.">http://www.commsvr.com</A>).<p><a href="http://www.commsvr.com/" target="_blank">Copyright (c) 2019 Mariusz Postol</a></p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:techsupp%40cas.eu?Subject=CommServer">CAS</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>