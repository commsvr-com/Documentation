<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Example simple database configuration</title><meta name="Language" content="en-us" /><meta name="System.Keywords" content="Example simple database configuration" /><meta name="System.Keywords" content="MS SQL" /><meta name="System.Keywords" content="SQL Conectivity, Verify connection" /><meta name="System.Keywords" content="SQL Conectivity, Requirements" /><meta name="System.Keywords" content="SQL Conectivity, Initial configuration" /><meta name="System.Keywords" content="SQL Conectivity, Transaction settings" /><meta name="System.Keywords" content="SQL Conectivity, Sample database file" /><meta name="System.Keywords" content="SQL Conectivity, Database attached to DataPorter" /><meta name="System.Keywords" content="SQL Conectivity, DataPorterDataBase.mdf" /><meta name="System.Keywords" content="SQL Conectivity, Troubleshooting" /><meta name="System.Keywords" content="SQL Conectivity, Connection to the local database server" /><meta name="System.Keywords" content="Sample database file" /><meta name="System.Keywords" content="opcvalue" /><meta name="System.Keywords" content="opcquality" /><meta name="System.Keywords" content="opcquality" /><meta name="System.Keywords" content="attach to MS SQL" /><meta name="System.Keywords" content="attach to MS SQL Express" /><meta name="Microsoft.Help.Id" content="9f3954b0-cc3e-46d1-a3e6-59649db7e738" /><meta name="Description" content="This walkthrough explains the possibility of using DataPorter to store data from OPC into database." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-3.3.1.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">CommServer<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/2dea0752-d490-47e6-8444-ac73e07601fc.htm" title="CommServer" tocid="roottoc">CommServer</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/b8c5f048-bb7e-4742-b7f2-b61a77789ed9.htm" title="DataPorter" tocid="b8c5f048-bb7e-4742-b7f2-b61a77789ed9">DataPorter</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/a5b37bb1-ca47-4770-900e-85b8da61cfe6.htm" title="Configuration" tocid="a5b37bb1-ca47-4770-900e-85b8da61cfe6">Configuration</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/26dd91e2-db6e-4a3a-ac32-a7f14422e466.htm" title="SQL Conectivity" tocid="26dd91e2-db6e-4a3a-ac32-a7f14422e466">SQL Conectivity</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/9f3954b0-cc3e-46d1-a3e6-59649db7e738.htm" title="Example simple database configuration" tocid="9f3954b0-cc3e-46d1-a3e6-59649db7e738">Example simple database configuration</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/42ac5182-238c-41a2-81a7-f66a77089b02.htm" title="Storing From Opc Into Sql " tocid="42ac5182-238c-41a2-81a7-f66a77089b02">Storing From Opc Into Sql </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/169261d2-f2b0-43f0-908a-bf6d23099aa1.htm" title="Reading from SQL and copying to OPC" tocid="169261d2-f2b0-43f0-908a-bf6d23099aa1">Reading from SQL and copying to OPC</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/f0eee719-9f00-47e8-8c6a-2052ba3f7dfa.htm" title="Advanced DataBase operation block" tocid="f0eee719-9f00-47e8-8c6a-2052ba3f7dfa">Advanced DataBase operation block</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Example simple database configuration</h1></td></tr></table><span class="introStyle"><A href="http://www.commsvr.com/tabid/55/language/en-US/Default.aspx" title="CommServer online help" target="_blank">Home</A></span> <div class="introduction"><p>
        This walkthrough explains the possibility of using DataPorter to store data from OPC into database.
      </p><p>
        The following requirements must be met:
      </p><ul><li><p>
            MS SQL 2005 Express (It is a free version of MS SQL 2005 database and it can be downloaded from Microsoft websites) database is installed on the test PC. Access to the database is configured so that an integrated MS Windows authentication is used and the selected user has relevant privileges in the database.
          </p></li><li><p>
            An OPC server is installed on the test PC – in this example a CommServer with default configuration is installed.
          </p></li><li><p>
            DataPorter version 1.21 or higher is installed on the test PC.
          </p></li></ul><div class="mediaCenter"><img alt="DataPorter SQL" src="../media/dataporter_SQL.png" /></div><p>This topic contains the following sections:</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#DataPorter_initial_configuration">DataPorter initial configuration</a></li><li class="outlineSectionEntry"><a href="#Database_attached_to_DataPorter">
        Information about a database attached to DataPorter (file: DataPorterDataBase.mdf)
      </a></li><li class="outlineSectionEntry"><a href="#Connection_of_DataPorter_to_the_local_database_server">
        Connection of DataPorter to the local database server
      </a></li><li class="outlineSectionEntry"><a href="#Troubleshooting">
        Troubleshooting
      </a></li></ul></div><div class="collapsibleAreaRegion" id="DataPorter_initial_configuration"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />DataPorter initial configuration</span></div><div id="ID0RBSection" class="collapsibleSection"><p>
          DataPorter is installed with a sample file of MS SQL Express database, which can easily be used to initiate storing into the database. After DataPorter has been installed, the database file is, by default, in the following location:
        </p><p>
          %programfiles%\cas\CAS DataPorter\DataPorterDataBase.mdf
        </p><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>
            We assume that DataPorter is installed in a default location (unchanged during the installation). %programfiles% is a system variable that determines location of the "Program files" catalogue in the system. It is " C:\Program Files" by default. To check what is the location on a given computer enter echo %programfiles% in the command line (Start Menu-&gt; Run-&gt;cmd). Information about the "Program Files" catalogue location is displayed.
          </p></td></tr></table></div><p>
          The goal of the exercise is to configure DataPorter software to store current values of the following tags (from OPC server into the database):
        </p><ul><li><p>
              PLC/R/100 always every 10 seconds
            </p></li><li><p>
              PLC/R/101 always when its value changes
            </p></li></ul><p>
          To start storing from OPC into the above mentioned database, configure DataPorter using OPC Viewer:
        </p><ol><li><p>
              Create a session including one group (e.g. called "gr1") that contains two OPC tags: PLC/R/100 and PLC/R/101; the result should be similar to the figure below:
            </p><div class="mediaCenter"><img alt="OPC Viewer sql" src="../media/sesja w opcviewerze.jpg" /></div></li><li><p>
              Now, create two transactions of two operations: Read OPC Item and PeriodicDB Save each. The figure below shows a fragment of the session tree with the two created transactions:
            </p><div class="mediaCenter"><img alt="OPC Viewer transaction" src="../media/sesja_z_transakcjami.jpg" /></div></li></ol><p>
          Transaction0 is responsible for storing PLC/R/100 at 10-second intervals and Transaction1 stores each change of the PLC/R/101 tag value. The layout of operation blocks for each transaction looks the same; only the input parameter (the tag name) and transaction settings are different. The figure below shows an example layout of the blocks:
        </p><div class="mediaCenter"><img alt="Transaction" src="../media/transakcja-bloczki.jpg" /></div><p>
          Blocks for Transaction1 differ in the input parameter (the PLC/R/101 tag name) of the Read Item block only.
        </p><p>
          The transaction settings (shown in the property window on the right of the application window). The figure below shows a comparison of those two settings:
        </p><div class="mediaCenter"><img alt="Transaction" src="../media/ustawienia_transakcji0i1.jpg" /></div><p>
          As you can see, the basic differences are as follows:
        </p><ul><li><p>
              Minimum Update Rate set to 10000 for Transaction0 - a value given in milliseconds (i.e. 10 seconds), which shows how often the transaction must be executed.
            </p></li><li><p>
              Trigger Item set to PLC/R/101 (gr1) for Transaction1 – means that a change of the PLC/R/101 tag value triggers the transaction (in Trigger Item Deadband you can set a percentage value to determine how great the change must be to trigger the transaction; a blank field means that any change is important).
            </p></li></ul><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>
            Of course both the settings, i.e. Minimum Update Rate and Trigger Item may be combined and, then, we receive a condition of the following type: trigger the transaction if the value of the selected tag changes but not less often than Minimum Update Rate (trigger the transaction at least every Minimum Update Rate)
          </p></td></tr></table></div><p>
          Settings of the "DB Save" operation block are also important but it is not necessary to modify the settings as DataPorter software has been preconfigured to use the mentioned database.
        </p><p>
          Now, the created session can be stored, preferably in the file:
        </p><p>
          “%programfiles%\cas\CAS DataPorter\DemoConfiguration.oses”
        </p><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>
            We assume that the default name of the DataPorter configuration file has not been changed.
          </p></td></tr></table></div><p>
          DataPorter software can be started now. DataPorter will store data into the base in the mentioned DataPorterDataBase.mdf file.
        </p></div><div class="collapsibleAreaRegion" id="Database_attached_to_DataPorter"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />
        Information about a database attached to DataPorter (file: DataPorterDataBase.mdf)
      </span></div><div id="ID2RBSection" class="collapsibleSection"><p>
          Let's take a closer look at the database attached to DataPorter. The base includes one table: OPCDataTable with the following columns:
        </p><ul><li><p>
              timestamp [datetime] NOT NULL – time stamp of the instant when inserting is effected,
            </p></li><li><p>
              name [nchar](255) NOT NULL – name of the stored tag,
            </p></li><li><p>
              opcvalue [float] NULL – tag value (as a real number),
            </p></li><li><p>
              opcquality [nchar](20) NULL – quality of the stored tag (the quality is stored as a text).
            </p></li></ul><p>
          The "DB Save" operation block executes the following SQL query inserting data to the base:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAEADAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAEADAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAEADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EAEADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">INSERT INTO OPCDataTable VALUES
(getdate(),'input[0].name', 'input[0].value', 'input[0].quality')</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAEADAAA");</script><p>
          The input[0] parameter means that the query uses the element (tag) connected to the first input of the "DB Save" operation block (but counted from 0); the next fields (here after a dot) show what is put in a given field.
        </p><p>
          It is also important how DataPorter is connected to the database. So called "connection string" is used to describe the connection. The following connection string is used in the default configuration:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EABADAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EABADAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EABADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EABADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">"Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|DataPorterDataBase.mdf; 
Integrated Security=True; Connect Timeout=30; User Instance=True"</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EABADAAA");</script><p>
          The method of connection defined that way causes that only one application (only one system process) may be connected to that database; therefore it is much better to connect the DataPorterDataBase.mdf file to the MS SQL or MS SQL Express database server and use the database by many applications.
        </p></div><div class="collapsibleAreaRegion" id="Connection_of_DataPorter_to_the_local_database_server"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />
        Connection of DataPorter to the local database server
      </span></div><div id="ID3RBSection" class="collapsibleSection"><p>
          Before you proceed with the activities described below, connect the database file attached to DataPorter (DataPorterDataBase.mdf) to MS SQL or MS SQL Express database. The name of the database created that way shall be DataPorterDataBase. DataPorter has been prepared so that you can easily "switch" from the local file to the MS SQL database server. For that purpose, click twice on the "DB Save" operation block. Next, find the following two lines at the beginning of the configuration:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAIACAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAIACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAIACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EAIACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">&lt;operationdb name="MSSQL" connectionstring="Data Source=.\SQLEXPRESS;
AttachDbFilename=|DataDirectory|DataPorterDataBase.mdf;Integrated Security=True;
Connect Timeout=30;User Instance=True" stop="false" type="ExecuteNonQuery" async="false"&gt;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAIACAAA");</script><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAHACAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAHACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAHACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EAHACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">&lt;!-- &lt;operationdb name="MSSQL" connectionstring="Data Source=.\SQLEXPRESS;
Initial Catalog=DataPorterDataBase;Integrated Security=True" stop="false" 
type="ExecuteNonQuery" async="false"&gt; --&gt;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAHACAAA");</script><p>
          Those two lines (starting with "&lt;") describe the method of connecting to the database (i.e. connection string and database type selection respectively). The second line (definition of connecting to the database) is not used (it is only a comment, according to XML). In order to switch over to the local MS SQL server, remove the first line and remove the comment marks from the second line (remove "&lt;!—" at the beginning and "--&gt;" at the end of the line) and you get the following from the above two lines:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAFACAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAFACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAFACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EAFACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">&lt;operationdb name="MSSQL" connectionstring="Data Source=.\SQLEXPRESS;
Initial Catalog=DataPorterDataBase;Integrated Security=True" stop="false" 
type="ExecuteNonQuery" async="false"&gt;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAFACAAA");</script><p>
          Finally, save the configuration and restart DataPorter.
        </p><p>
          To verify if storing into the database works properly, use the database manager and check the content of OPCDataTable table or simply enter (Menu Start -&gt; Run -&gt; cmd) in the command line:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EACACAAA_tab1" class="codeSnippetContainerTabSingle">scr</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EACACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EACACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EACACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">sqlcmd -S localhost\SQLEXPRESS -d DataPorterDataBase -Q
"SELECT TOP 5 * FROM [DataPorterDataBase].[dbo].[OPCDataTable] ORDER BY timestamp DESC"</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EACACAAA");</script><p>
          That command should return five most recent rows in the database. In my example it produced the following result:
        </p><div class="mediaCenter"><img alt="Most recent rows in the database" src="../media/wynik_działania.jpg" /></div></div><div class="collapsibleAreaRegion" id="Troubleshooting"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />
        Troubleshooting
      </span></div><div id="ID4RBSection" class="collapsibleSection"><p>
          If problems occur (e.g. no entries in the database), examine the application logs, both in the Windows system logs (Menu Start-&gt;Run-&gt;eventvwr.msc) and DataPorter logs ("%ProgramFiles%\CAS\CAS DataPorter\log\DataPorter.log"), where entries should help us find the problem reason.
        </p><p>
          Check also whether the MS SQL database server is configured in a proper way, the integrated authentication is enabled, and the present user has sufficient privileges in the database.
        </p></div></div></div><div id="pageFooter" class="pageFooter">This documentation is designed to be used with CAS CommServer (this software is available at <A href="http://www.commsvr.com/index.php/products" title="CommServer -multiprotocol, multichannel, redundant communication server – software installation.">http://www.commsvr.com</A>).<p><a href="http://www.commsvr.com/" target="_blank">Copyright (c) 2019 Mariusz Postol</a></p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:techsupp%40cas.eu?Subject=CommServer">CAS</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>