<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>MODBUS IP configuration</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="a8c2de7c-5c00-4835-9b36-62bddfeb54be" /><meta name="Description" content="Select TCP or UDP as protocol. Socket number settings are ignored and can be set by default as –1 (this setting is valid only for slave sides of the protocol)." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-3.3.1.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">CommServer<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/2dea0752-d490-47e6-8444-ac73e07601fc.htm" title="CommServer" tocid="roottoc">CommServer</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/2dea0752-d490-47e6-8444-ac73e07601fc.htm" title="CommServer" tocid="2dea0752-d490-47e6-8444-ac73e07601fc">CommServer</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/de241950-87e4-40df-ba6c-99579ddc467e.htm" title="Configuration" tocid="de241950-87e4-40df-ba6c-99579ddc467e">Configuration</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/82a59c6f-7225-46b8-be5d-d7517b386965.htm" title="Using NetworkConfig to configure the network" tocid="82a59c6f-7225-46b8-be5d-d7517b386965">Using NetworkConfig to configure the network</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/8b586f8f-6dad-43e6-8b9e-56e5d713fa34.htm" title="Protocol" tocid="8b586f8f-6dad-43e6-8b9e-56e5d713fa34">Protocol</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/998872e0-7f6c-45b0-ab3a-ba2dd6de0373.htm" title="MBUS configuration" tocid="998872e0-7f6c-45b0-ab3a-ba2dd6de0373">MBUS configuration</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/a8c2de7c-5c00-4835-9b36-62bddfeb54be.htm" title="MODBUS IP configuration" tocid="a8c2de7c-5c00-4835-9b36-62bddfeb54be">MODBUS IP configuration</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/1b9d7777-99cc-4059-a57f-124a4d81b498.htm" title="MODBUS RS configuration" tocid="1b9d7777-99cc-4059-a57f-124a4d81b498">MODBUS RS configuration</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/08f7c3a4-0f76-4de5-a067-f471e3d84200.htm" title="SBUS IP configuration" tocid="08f7c3a4-0f76-4de5-a067-f471e3d84200">SBUS IP configuration</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fbb931d4-5f2b-4368-a78b-45d713fdc684.htm" title="SBUS RS configuration" tocid="fbb931d4-5f2b-4368-a78b-45d713fdc684">SBUS RS configuration</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>MODBUS IP configuration</h1></td></tr></table><span class="introStyle"><A href="http://www.commsvr.com/tabid/55/language/en-US/Default.aspx" title="CommServer online help" target="_blank">Home</A></span> <div class="collapsibleAreaRegion" id="MODBUSIPCommunicationInterfaceSettings"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Communication interface settings</span></div><div id="ID0RBSection" class="collapsibleSection"><div class="mediaCenter"><img alt="Communication interface settings" src="../media/MODBUSIPCommunication_interface_settings.jpg" /><div class="caption"><span class="captionLead">Figure1:
						</span>Communication interface settings</div></div><p>Select TCP or UDP as protocol. Socket number settings are ignored and can be set by default as –1 (this setting is valid only for slave sides of the protocol).</p></div><div class="collapsibleAreaRegion" id="MODBUSIPModbusProtocolSettings"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Modbus protocol settings</span></div><div id="ID1RBSection" class="collapsibleSection"><div class="mediaCenter"><img alt="Modbus protocol settings" src="../media/MODBUSIPprotocol_settings.jpg" /><div class="caption"><span class="captionLead">Figure2:
						</span>Modbus protocol settings</div></div><p>CommServer allows us to tune the timeout settings that are used in the Modbus DataProvider. The following settings are available:</p><ul><li><p><em>InterframeGap</em> - period of time in milliseconds between consecutive request frames
            </p></li><li><p><em>MaxNumberOfRetries</em> - maximal number of retries getting the response. After this limit has passed the base station finds that communication with the device using current interface coupled with this protocol is broken and it activates the next interface in the pipe if available. The failed interface is marked inactive and will remain in this state until the defined (as “inactive time after failed”) timeout expiration.
            </p></li><li><p><em>ResponseTimeOut</em> - maximal time of waiting for the response from a remote device
            </p></li><li><p><em>Timeout15</em> - maximal wait time in microseconds for the next character inside Modbus telegram (Modbus specifications defines this time as time of 1.5 character that goes through the communication layer, but due to Windows limitation it is not recommended to set this timeout to less than 11 milliseconds)
            </p></li><li><p><em>Timeout3</em> - maximal wait time for the next character while waiting for the response frame end (a silent interval separating message frames, e.g. 3.5 character times for Modbus)
            </p></li></ul><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>The default settings are optimal for communication over the serial link; if TCP/UDP transportation it is recommended to tune the settings.</p></td></tr></table></div><p>It is necessary to set a valid segment address. This address is the address of the PLC that we want to connect to. Below there is an example of connection settings to PLC. In this case TCP is used:</p><div class="mediaCenter"><img alt="Example of connection settings to PLC" src="../media/MODBUSIPconnection_settings_to_PLC.jpg" /><div class="caption"><span class="captionLead">Figure3:
						</span>Example of connection settings to PLC</div></div><p>The syntax of the segment address is:</p><p>server_IP_address:port_to_which_commserver_establish_the_connection</p><p>In the figure below there is an example connection to PLC, whose IP address is 192.168.0.8 and communication port is 2101:</p><div class="mediaCenter"><img alt="Example connection to PLC" src="../media/MODBUSIPexample_connection_to_PLC.jpg" /><div class="caption"><span class="captionLead">Figure4:
						</span>Example connection to PLC</div></div></div><div class="collapsibleAreaRegion" id="MODBUSIPConfigurationAndInterpretationOfReceivedData"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Configuration and interpretation of received data</span></div><div id="ID2RBSection" class="collapsibleSection"><p>Modbus DataProvider reads the data in blocks. Requests are sent to the device (called station in the CommServer configuration) that has an address (according to Modbus protocol) set inside port (interface) definition. The user can freely define a block of data to be read. The block of data is received as an answer from the device.</p><p>During the configuration of the data block, the following settings must be configured:</p><ul><li><p>Address – the initial address of the block </p></li><li><p>Data Type – the address space in the device to be read (available address spaces are: Coils, Discrete Inputs, Holding Registers, Input Registers, Memory Bank Registers , 8 bits Holding Registers )</p></li><li><p>Name – the name of the data block in the CommServer configuration (not used during communication)</p></li><li><p>Tags collection – tags definitions inside the block. Each tag has:</p><ul><li><p>Name – the name of the tag inside the OPC server address space</p></li><li><p>Access Rights - indicate if this item is read only, write only or read/write. This is NOT related to security but rather to the nature of the underlying hardware</p></li><li><p>DataTypeConversion - conversion requirements. Data will be available in the required type (if conver-sion is possible).</p></li></ul></li></ul></div><div class="collapsibleAreaRegion" id="MODBUSIPAddressingInModbusSddressVsOffset"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Addressing in Modbus: address vs offset (reference)</span></div><div id="ID3RBSection" class="collapsibleSection"><p>In Modbus protocol, the block address indicates the offset of a particular element within its address space (e.g. holding register, coils, etc.), but this offset may not be equal to physical address of this element in the memory. An example of such situation is a Modicon 984 controller, where:</p><ul><li><p>Register at reference 0 is address 40001 in Modicon 984</p></li><li><p>Coil at reference 0 is address 00001 in Modicon 984</p></li></ul><p>That’s why sometimes it is necessary to change the address to offset (e.g. subtract 40001 when a Holding Register is concerned) and finally the offset (not address) must be inserted to the CommServer block configuration.</p></div><div class="collapsibleAreaRegion" id="MODBUSIP32-bitRegisterAndFloatingPointNumbersExtension"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />32-bit register and floating point numbers extension</span></div><div id="ID4RBSection" class="collapsibleSection"><p>The Modbus DataProvider supports also some extension to Modbus protocol, e.g.:</p><ul><li><p>32-bit Holding Register</p></li><li><p>Floating point values</p></li></ul><p>In Modbus, a 32-bit register is transmitted as two standard (16-bit) registers. There are two modes of how 32-bit registers are transmitted. In the first mode (usually called Modicon), the first register contains bits 15 - 0 of the 32-bit number, and the second register contains bits 31 - 16 of the 32-bit number. In the second mode (called inverted), the order of those two registers is inverted. The Modbus DataProvider supports both modes and the mode can be selected in DataProvider settings in the RegisterOrderIn32mode property (see figure below).</p><p>In case of the necessity of using 32-bit Holding Register, a special block data type must be selected: Holding_32bit_Register (see figure below). Note that floating point numbers are available only when 32-bit registers are used.</p><p>As far as floating point numbers are concerned, the proper floating point format must be selected. This DataProvider supports two modes: Modicon [standard: the first register contains bits 15 - 0 of the 32-bit number (bits 15 - 0 of significant), and the second register contains bits 31 - 16 of the 32-bit number (exponent and bits 23 - 16 of significant)] and IEEE (inverted: IEEE floating point number format is used). The mode can be selected in DataProvider settings in the FloatingPoint  property (see figure below). What is more, conversion to System.Single must be set for each item that should be available in OPC as floating point number. </p><div class="mediaCenter"><img alt="DataProvider, Block ant Item settings" src="../media/DataProvider_Block_Item_settings.jpg" /><div class="caption"><span class="captionLead">Figure5:
						</span>DataProvider, Block ant Item settings</div></div></div></div></div><div id="pageFooter" class="pageFooter">This documentation is designed to be used with CAS CommServer (this software is available at <A href="http://www.commsvr.com/index.php/products" title="CommServer -multiprotocol, multichannel, redundant communication server – software installation.">http://www.commsvr.com</A>).<p><a href="http://www.commsvr.com/" target="_blank">Copyright (c) 2019 Mariusz Postol</a></p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:techsupp%40cas.eu?Subject=CommServer">CAS</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>